## _function build_prompt(task)
**build_prompt**: The function of build_prompt is to generate a prompt string for the OpenAI ChatCompletion API. 

**parameters**:
- task: A string representing the task for which the prompt is being built.

**Code Description**:
The build_prompt function takes a task as input and generates a prompt string by replacing the "__TASK__" placeholder in the prompt template with the given task. The prompt template is stored in the variable "prompt". 

If there are any recent question-answer tuples (RECENT_QA_TUPLES), the function appends a section to the prompt string that includes the history of question-answer pairs. It iterates over each tuple in RECENT_QA_TUPLES and appends the question, the string "ANSWER:", and the corresponding answer to the prompt string. Each question-answer pair is separated by a newline character.

If there are no recent question-answer tuples, the function appends a section to the prompt string indicating that the Q&A history is empty.

Finally, the function returns the generated prompt string.

The build_prompt function is called by the query function in the Demo2_BringCommands.py/query object. The query function uses the prompt generated by build_prompt as input to the OpenAI ChatCompletion API. It sends a request to the API with the prompt and retrieves the response. The response is then processed to extract the desired content, which is returned by the query function.

**Note**: 
- The build_prompt function assumes that the variable "prompt" is defined and accessible within the scope of the function.
- The function relies on the global variable RECENT_QA_TUPLES to determine if there are any recent question-answer tuples.
- The function does not handle any exceptions or errors that may occur during the execution.

**Output Example**:
If the task is "Translate the following sentence to French: 'Hello, how are you?'", and there are two recent question-answer tuples:
- Q: "What is the capital of France?" A: "Paris"
- Q: "Who is the current President of the United States?" A: "Joe Biden"

The output of the build_prompt function would be:
"Translate the following sentence to French: 'Hello, how are you?' Q&A history:
What is the capital of France? ANSWER: Paris
Who is the current President of the United States? ANSWER: Joe Biden"
## _function query(task)
**query**: The function of query is to send a request to the OpenAI ChatCompletion API with a prompt and retrieve the response.

**parameters**:
- task: A string representing the task for which the response is being queried.

**Code Description**:
The query function takes a task as input and generates a prompt string by calling the build_prompt function. It then sends a request to the OpenAI ChatCompletion API with the generated prompt and retrieves the response. The response is processed to extract the desired content, which is returned by the query function.

Inside the function, a try-except block is used to handle any exceptions that may occur during the API call. If an exception is caught, an error message is printed, and the function waits for 10 seconds before retrying the API call.

The response from the API is stored in the variable "response". The desired content is extracted from the response using the following steps:
- The "choices" key of the response contains a list of choices.
- The first choice in the list is selected using indexing: response['choices'][0].
- The selected choice contains a nested dictionary with the message content: response['choices'][0]['message']['content'].
- The content is assigned to the variable "ret" and returned by the function.

**Note**: 
- The function assumes that the build_prompt function is defined and accessible within the scope of the query function.
- The function relies on the OpenAI package being imported and the ChatCompletion API being available.
- The function does not handle any exceptions or errors that may occur during the execution.

**Output Example**:
If the task is "Translate the following sentence to French: 'Hello, how are you?'", and the response from the API is "Bonjour, comment ça va ?", the output of the query function would be:
"Bonjour, comment ça va ?"
## _function parseOutput(LM_output)
**parseOutput**: The function of parseOutput is to process the output generated by a language model (LM) and perform specific actions based on the content of the output.

**parameters**:
- LM_output: A string representing the output generated by the language model.

**Code Description**:
The `parseOutput` function takes in the `LM_output` as a parameter and performs the following actions:

1. It first checks if the LM_output does not contain the character "(" using the `not in` operator. If this condition is true, it further checks if the LM_output does not end with the character "?". If both conditions are true, it prints an error message indicating that the question is not valid and exits the program with a status code of 0. Otherwise, it calls the `NAR.AddInput` function with specific arguments and returns the result.

2. If the LM_output does contain the character "(", it returns None.

**Note**: The `NAR.AddInput` function is called with various arguments depending on the conditions in the code. The specific arguments used in each case are not provided in the code snippet.

**Output Example**: 
- If the LM_output does not contain "(", and does not end with "?", the function will print an error message and exit the program.
- If the LM_output does not contain "(", but ends with "?", the function will call the `NAR.AddInput` function with specific arguments and return the result.
- If the LM_output contains "(", the function will return None.
## _function AddInput(task)
**AddInput**: The function of AddInput is to process a given task and perform specific actions based on the content of the task.

**parameters**:
- task: A string representing the task to be processed.

**Code Description**:
The `AddInput` function takes in a task as input and performs the following actions:

1. It initializes the global variable `RECENT_QA_TUPLES` as an empty list.

2. It checks if the task ends with "!". If this condition is true, it enters a while loop.

3. Inside the while loop, it calls the `query` function with the task as input and assigns the returned value to the variable `LM_output`.

4. It calls the `parseOutput` function with `LM_output` as input and assigns the returned value to the variable `ret`.

5. If `ret` is None, it performs the following actions:
   - It converts `LM_output` to a Narsese goal by extracting specific arguments from it.
   - It checks if the extracted arguments are properly grounded.
   - If the arguments are properly grounded, it constructs a Narsese goal string and prints it.
   - It calls the `NAR.AddInput` function with the constructed goal as input and returns the result.

6. If `ret` is not None, it retrieves the NARS output from `ret` and stores it in the variable `NARS_output`.

7. It prints the `LM_output` and `NARS_output` values.

8. It appends a tuple containing the `LM_output` and `NARS_output` values to the `RECENT_QA_TUPLES` list.

9. The while loop continues until the task no longer ends with "!".

10. If the task does not end with "!", it calls the `NAR.AddInput` function with the task as input and returns the result.

**Note**: 
- The function assumes that the `query` and `parseOutput` functions are defined and accessible within the scope of the `AddInput` function.
- The function relies on the global variable `RECENT_QA_TUPLES` being defined and accessible.
- The function does not handle any exceptions or errors that may occur during the execution.

**Output Example**:
If the task is "Translate the following sentence to French: 'Hello, how are you?'", and the response from the API is "Bonjour, comment ça va ?", the output of the `AddInput` function would be:
"Bonjour, comment ça va ?"
## _function Shell
**Shell**: The function of Shell is to continuously accept user input and pass it to the AddInput function for further processing.

**parameters**:
- None

**Code Description**:
The `Shell` function is a loop that continuously accepts user input and passes it to the `AddInput` function. It does not take any parameters.

1. Inside the loop, it uses the `input()` function to prompt the user for input and assigns the input to the variable `task`.

2. It then calls the `AddInput` function with the `task` as the argument.

3. The `AddInput` function processes the task and performs specific actions based on its content.

4. After the `AddInput` function returns, the loop continues to the next iteration and prompts the user for input again.

5. The loop continues indefinitely until the program is terminated.

**Note**: 
- The `AddInput` function is assumed to be defined and accessible within the scope of the `Shell` function.
- The `Shell` function does not handle any exceptions or errors that may occur during the execution.

Now, let's take a look at the `AddInput` function to understand the specific actions performed on the task input.
